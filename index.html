<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Financial Statement Generator - ₱ Peso</title>
<style>
  * { box-sizing: border-box; }
  body, html {
    margin: 0; padding: 0; height: 100%;
    font-family: 'Segoe UI', sans-serif;
    background: #f3ede5; color: #5a381e;
  }

  header {
    background: #a97453; color: white;
    padding: 10px 20px;
    display: flex; align-items: center; justify-content: space-between;
    flex-wrap: wrap;
  }

  header h1 { font-size: 1.4rem; margin: 0; }

  /* ===== APP LAYOUT ===== */
  main {
    display: flex;
    flex-direction: row;
    justify-content: space-around;
    align-items: flex-start;
    padding: 20px;
    gap: 20px;
    height: calc(100vh - 80px);
    overflow-y: auto;
  }

  section {
    background: #fff8f0;
    border-radius: 15px;
    box-shadow: 0 6px 12px rgba(0,0,0,0.1);
    padding: 20px;
    overflow-y: auto;
  }

  /* Input section (now same width as summary) */
  #input-section {
    flex: 1;
    max-width: 50%;
    min-width: 320px;
  }

  /* Summary section same width */
  #summary-section {
    flex: 1;
    max-width: 50%;
  }

  input, select {
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #a97453;
    width: 100%;
  }

  button {
    cursor: pointer;
    border: none;
    border-radius: 8px;
    padding: 10px;
    font-weight: bold;
  }

  button:hover { opacity: 0.9; transition: 0.2s; }

  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
    font-size: 0.9rem;
  }

  th, td {
    border: 1px solid #d2b48c;
    padding: 8px;
    text-align: left;
    word-wrap: break-word;
  }

  th { background: #deb887; }

  .controls {
    margin-top: 15px;
    display: flex;
    gap: 10px;
    justify-content: center;
    flex-wrap: wrap;
  }

  #logout-btn { background: #d2691e; color: white; }
  #download-btn { background: #8b4513; color: white; }

  /* ===== LOGIN ===== */
  #login-screen {
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    background: #f3ede5;
    padding: 20px;
  }

  .card {
    background: #fff8f0;
    padding: 25px;
    border-radius: 15px;
    box-shadow: 0 5px 10px rgba(0,0,0,0.1);
    width: 100%;
    max-width: 320px;
  }

  #login-form {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  #app-screen {
    display: none;
    flex-direction: column;
    height: 100vh;
  }

  /* ===== MOBILE VIEW ===== */
  @media(max-width: 768px) {
    header {
      flex-direction: column;
      align-items: center;
      gap: 8px;
      text-align: center;
    }

    header h1 { font-size: 1.1rem; }

    main {
      flex-direction: column;
      align-items: center;
      height: auto;
      padding: 10px;
    }

    section {
      width: 100%;
      max-width: 98%;
      margin-bottom: 20px;
    }

    /* Both sections full width on mobile */
    #input-section, #summary-section {
      width: 100%;
      max-width: 100%;
      flex: none;
    }

    table {
      font-size: 0.9rem;
    }

    input, select, button {
      font-size: 0.9rem;
      padding: 8px;
    }
  }

  @media(max-width: 400px) {
    header h1 { font-size: 1.6rem; }
    .card { padding: 15px; }
    table { font-size: 0.85rem; }
    button { padding: 7px; font-size: 0.85rem; }
  }
</style>
</head>
<body>

<!-- LOGIN -->
<div id="login-screen">
  <div class="card">
    <h2>FinSavvy Generator</h2>
    <form id="login-form">
      <label>Username</label>
      <input type="text" id="username" required />
      <label>Password</label>
      <input type="password" id="password" required />
      <button type="submit" style="background:#a97453; color:white;">Login</button>
    </form>
    <p id="login-error" style="color:red; display:none;">Invalid username or password!</p>
   <p style="margin-top:10px; font-size:0.9rem;">Use <b>Admin / 1234</b> as an example</p>
  </div>
</div>

<!-- APP -->
<div id="app-screen">
<header style="padding:20px 25px;">
  <div style="display:flex; align-items:center; gap:20px;">
    <!-- Glasses Logo with thinner frame and centered calculator -->
    <svg width="100" height="60" viewBox="0 0 64 32" xmlns="http://www.w3.org/2000/svg">
      <!-- Thinner Glasses frame -->
      <circle cx="16" cy="16" r="12" stroke="#fff" stroke-width="2.5" fill="none"/>
      <circle cx="48" cy="16" r="12" stroke="#fff" stroke-width="2.5" fill="none"/>
      <line x1="28" y1="16" x2="36" y2="16" stroke="#fff" stroke-width="2.5"/>
      
      <!-- Smaller Calculator centered on right lens -->
      <rect x="44" y="11" width="10" height="10" fill="#fff" rx="2"/>
      <line x1="45" y1="12" x2="53" y2="12" stroke="#a97453" stroke-width="1"/>
      <line x1="45" y1="14" x2="53" y2="14" stroke="#a97453" stroke-width="1"/>
      <line x1="45" y1="16" x2="53" y2="16" stroke="#a97453" stroke-width="1"/>
      <line x1="45" y1="18" x2="53" y2="18" stroke="#a97453" stroke-width="1"/>
    </svg>
    
    <h1 style="margin:0; color:white; font-size:2.2rem;">FS Generator</h1>
  </div>
  <button id="logout-btn" style="padding:12px 20px; font-size:1rem;">Logout</button>
</header>


  <main>
    <section id="input-section">
      <h2>Add Transaction</h2>
      <form id="transaction-form">
        <label>Date</label>
        <input type="date" id="date" required />
        <label>Description</label>
        <input type="text" id="description" required />
        <label>Category</label>
        <select id="category" required>
          <option value="">Select Category</option>
          <option value="revenue">Revenue</option>
          <option value="expense">Expense</option>
          <option value="asset">Asset</option>
          <option value="liability">Liability</option>
          <option value="equity">Equity</option>
        </select>
        <label>Amount (₱)</label>
        <input type="number" id="amount" step="0.01" required />
        <button type="submit" style="background:#a97453; color:white;">Add Transaction</button>
      </form>

      <div style="overflow-x:auto;">
        <table id="transactions-table" style="display:none;">
          <thead>
            <tr><th>Date</th><th>Description</th><th>Category</th><th>Amount (₱)</th><th>Action</th></tr>
          </thead>
          <tbody id="transactions-body"></tbody>
        </table>
      </div>
    </section>

    <section id="summary-section">
      <h2>Reports</h2>
      <div class="report-block">
        <h3>Income Statement</h3>
        <table>
          <tr><td>Revenue</td><td id="rev">₱0.00</td></tr>
          <tr><td>Expense</td><td id="exp">₱0.00</td></tr>
          <tr><td>Net Income</td><td id="net">₱0.00</td></tr>
        </table>
      </div>
      <div class="report-block" style="margin-top:20px;">
        <h3>Balance Sheet</h3>
        <table>
          <tr><td>Assets</td><td id="asset">₱0.00</td></tr>
          <tr><td>Liabilities</td><td id="liab">₱0.00</td></tr>
          <tr><td>Equity</td><td id="eq">₱0.00</td></tr>
        </table>
      </div>
      <div class="controls">
        <button id="download-btn">Download Excel</button>
      </div>
    </section>
  </main>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script>
  const loginScreen = document.getElementById('login-screen');
  const appScreen = document.getElementById('app-screen');
  const loginForm = document.getElementById('login-form');
  const errorMsg = document.getElementById('login-error');

  let currentUser = null;
  let transactions = [];

  // Add register link
  const registerLink = document.createElement('p');
  registerLink.innerHTML = `Don't have an account? <a href="#" id="register-link">Create one</a>`;
  document.querySelector('.card').appendChild(registerLink);

  // Create Register Form dynamically
  const registerFormHTML = `
    <h2>Create Account</h2>
    <form id="register-form">
      <label>New Username</label>
      <input type="text" id="new-username" required />
      <label>New Password</label>
      <input type="password" id="new-password" required />
      <button type="submit" style="background:#a97453; color:white;">Register</button>
    </form>
    <p id="register-error" style="color:red; display:none;">Username already exists!</p>
    <p id="register-success" style="color:green; display:none;">Account created! You can log in now.</p>
    <p style="margin-top:10px; font-size:0.9rem;"><a href="#" id="back-to-login">Back to Login</a></p>
  `;

  // Show register form
  document.addEventListener('click', e => {
    if (e.target.id === 'register-link') {
      e.preventDefault();
      document.querySelector('.card').innerHTML = registerFormHTML;
    }
    if (e.target.id === 'back-to-login') {
      e.preventDefault();
      location.reload(); // reloads to show login form again
    }
  });

  // Handle Register Form Submission
  document.addEventListener('submit', e => {
    if (e.target.id === 'register-form') {
      e.preventDefault();
      const newUser = document.getElementById('new-username').value.trim();
      const newPass = document.getElementById('new-password').value.trim();

      if (!newUser || !newPass) return;

      const users = JSON.parse(localStorage.getItem("users") || "{}");

      if (users[newUser]) {
        document.getElementById("register-error").style.display = "block";
        document.getElementById("register-success").style.display = "none";
      } else {
        users[newUser] = { password: newPass };
        localStorage.setItem("users", JSON.stringify(users));
        document.getElementById("register-error").style.display = "none";
        document.getElementById("register-success").style.display = "block";
        setTimeout(() => location.reload(), 1500);
      }
    }
  });

  // Handle Login
  loginForm.addEventListener('submit', e => {
    e.preventDefault();
    const user = document.getElementById('username').value.trim();
    const pass = document.getElementById('password').value.trim();

    const users = JSON.parse(localStorage.getItem("users") || "{}");

    if (users[user] && users[user].password === pass) {
      currentUser = user;
      loginScreen.style.display = "none";
      appScreen.style.display = "flex";
      loadUserData();
    } else {
      errorMsg.style.display = "block";
    }
  });

  document.getElementById('logout-btn').addEventListener('click', () => {
    saveUserData();
    appScreen.style.display = "none";
    loginScreen.style.display = "flex";
  });

  const form = document.getElementById('transaction-form');
  const tbody = document.getElementById('transactions-body');
  const table = document.getElementById('transactions-table');

  form.addEventListener('submit', e => {
    e.preventDefault();
    const tx = {
      date: document.getElementById('date').value,
      description: document.getElementById('description').value,
      category: document.getElementById('category').value,
      amount: parseFloat(document.getElementById('amount').value)
    };
    transactions.push(tx);
    saveUserData();
    form.reset();
    updateTable();
    updateReports();
  });

  function updateTable() {
    tbody.innerHTML = "";
    if (transactions.length === 0) {
      table.style.display = "none";
      return;
    }
    table.style.display = "table";
    transactions.forEach((tx, i) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${tx.date}</td>
        <td>${tx.description}</td>
        <td>${tx.category}</td>
        <td>₱${tx.amount.toFixed(2)}</td>
        <td><button onclick="removeTx(${i})" style="color:red;">✕</button></td>
      `;
      tbody.appendChild(tr);
    });
  }

  function removeTx(index) {
    transactions.splice(index, 1);
    saveUserData();
    updateTable();
    updateReports();
  }

  function updateReports() {
    const rev = sum("revenue");
    const exp = sum("expense");
    const asset = sum("asset");
    const liab = sum("liability");
    const eq = sum("equity");
    const net = rev - exp;

    document.getElementById("rev").textContent = `₱${rev.toFixed(2)}`;
    document.getElementById("exp").textContent = `₱${exp.toFixed(2)}`;
    document.getElementById("net").textContent = `₱${net.toFixed(2)}`;
    document.getElementById("asset").textContent = `₱${asset.toFixed(2)}`;
    document.getElementById("liab").textContent = `₱${liab.toFixed(2)}`;
    document.getElementById("eq").textContent = `₱${(eq + net).toFixed(2)}`;
  }

  function sum(cat) {
    return transactions.filter(t => t.category === cat).reduce((a,b)=>a+b.amount,0);
  }

  function saveUserData() {
    if (currentUser) {
      localStorage.setItem("transactions_" + currentUser, JSON.stringify(transactions));
    }
  }

  function loadUserData() {
    const saved = localStorage.getItem("transactions_" + currentUser);
    transactions = saved ? JSON.parse(saved) : [];
    updateTable();
    updateReports();
  }

  // Enhanced Excel Export (same as before)
  document.getElementById('download-btn').addEventListener('click', () => {
    if (transactions.length === 0) return alert("No transactions to download!");

    const wb = XLSX.utils.book_new();
    const rev = sum("revenue");
    const exp = sum("expense");
    const asset = sum("asset");
    const liab = sum("liability");
    const eq = sum("equity");
    const net = rev - exp;

    const incomeData = [
      { Section: "REVENUE", Description: "", Amount: "" },
      ...transactions.filter(t => t.category === "revenue").map(t => ({
        Section: "", Description: t.description, Amount: t.amount
      })),
      { Section: "Total Revenue", Description: "", Amount: rev },
      { Section: "", Description: "", Amount: "" },
      { Section: "EXPENSES", Description: "", Amount: "" },
      ...transactions.filter(t => t.category === "expense").map(t => ({
        Section: "", Description: t.description, Amount: t.amount
      })),
      { Section: "Total Expense", Description: "", Amount: exp },
      { Section: "", Description: "", Amount: "" },
      { Section: "NET INCOME", Description: "", Amount: net }
    ];

    const balanceData = [
      { Section: "ASSETS", Description: "", Amount: "" },
      ...transactions.filter(t => t.category === "asset").map(t => ({
        Section: "", Description: t.description, Amount: t.amount
      })),
      { Section: "Total Assets", Description: "", Amount: asset },
      { Section: "", Description: "", Amount: "" },
      { Section: "LIABILITIES", Description: "", Amount: "" },
      ...transactions.filter(t => t.category === "liability").map(t => ({
        Section: "", Description: t.description, Amount: t.amount
      })),
      { Section: "Total Liabilities", Description: "", Amount: liab },
      { Section: "", Description: "", Amount: "" },
      { Section: "EQUITY", Description: "", Amount: "" },
      ...transactions.filter(t => t.category === "equity").map(t => ({
        Section: "", Description: t.description, Amount: t.amount
      })),
      { Section: "Total Equity", Description: "", Amount: eq + net }
    ];

    const wsIncome = XLSX.utils.json_to_sheet(incomeData);
    const wsBalance = XLSX.utils.json_to_sheet(balanceData);

    XLSX.utils.book_append_sheet(wb, wsIncome, "Income Statement");
    XLSX.utils.book_append_sheet(wb, wsBalance, "Balance Sheet");

    wsIncome["!cols"] = [{ wch: 20 }, { wch: 40 }, { wch: 15 }];
    wsBalance["!cols"] = [{ wch: 20 }, { wch: 40 }, { wch: 15 }];

    const summaryData = [
      ["Summary of Financial Statements"],
      ["Revenue", rev],
      ["Expense", exp],
      ["Net Income", net],
      ["Assets", asset],
      ["Liabilities", liab],
      ["Equity (incl. Net Income)", eq + net]
    ];
    const wsSummary = XLSX.utils.aoa_to_sheet(summaryData);
    XLSX.utils.book_append_sheet(wb, wsSummary, "Summary Overview");
    wsSummary["!cols"] = [{ wch: 30 }, { wch: 20 }];

    XLSX.writeFile(wb, `Financial_Statements_${currentUser}.xlsx`);
  });
</script>
